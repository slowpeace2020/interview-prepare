# 秒杀中台

## 业务架构

### 功能分离
确保核心功能高可用，高并发
按功能重要程度，区分核心和非核心功能
按功能的流量特点，区分流量突发型、流量平缓型，对突发型的功能做好隔离

#### 功能隔离
怎么隔离？单独的域名、接入层、隔离的服务层，单独的缓存、数据库
域名隔离，代理、微服务、缓存、数据库

#### 功能降级
自动，根据指标，比如错误率、响应时间，阈值，自动降级
手动，使用配置中心，对可降级服务设置开关，可以开发运维管理程序，后台控制点击按钮

### 系统分层


## 数据存储架构


## 流量架构

10万QPS怎么算出来的？

### 单元化？

最高做过多少QPS的项目，我们现在是1万用户，未来两年10万，100万，亿级用户，做了流量规划。说自己做过10w QPS的流量预估，规划和预测，压测。

### 流量架构
老版本升级，流量预估，参考监控数据，服务能力，流量指标
不同场景，不同用户量的流量预估，各组件部署架构

新系统流量预估，压测，性能预期指标，

通过用户量预估QPS
通过用户量推算PV(page visit)
公式：（总用户数*20%）*每天大致点击次数（淘宝经验30-50次）=pv数
用户数是1000万，pv量是多少？
1000万*20%*30 = 6000万

PV推算QPS公式
（总PV数*80%）/(每天秒数*20%)=峰值时间每秒请求数（QPS）
6000万*80%/86400*20%=4800万/17280(QPS)=2700

加上冗余系数
根据行业经验，冗余系数在2-5之间，提高预期标准，防止认为评估造成预期指标偏低
所以，2700*4 = 10800（QPS）

冗余系数不断迭代，根据线上数据积累调整

10万级  108QPS
100万级 1080QPS
千万级  10800QPS
亿级    108000QPS，10万

亿级流量每层架构的基数值
LVS 10 万
Nginx 5万
MQ 10万
SpringCloud Gateway 1K QPS
Tomcat 1K QPS
MySQL 1.5K QPS

为什么Nginx支持的并发量高？

MySQL数据库查询能力
主键查询：千万级别1-10ms，4核心 8线程 1000qps * 8 = 8000QPS
唯一索引查询：千万级别10-100ms，4核心 8线程 100qps * 8 = 800QPS
非唯一索引查询：千万级别100-1000ms，4核心 8线程 10qps * 8 = 80QPS
无索引：百万数据1000ms+
综合来说mysql的并发能力大概在1500QPS

## 亿级流量库表设计
单表500万条记录，
800万条警戒线
1000万必须分库分表











